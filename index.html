<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø¯ - Ø´Ø±ÙƒØ© Ø§Ù„Ù‚Ø±Ø¹Ø§ÙˆÙŠ</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@zxing/browser@0.2.7/esm/index.min.js" rel="modulepreload">
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Cairo', sans-serif;
    }

    body {
      margin: 0;
      background-color: #f4f4f4;
    }

    header {
      background-color: #00796b;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      position: relative;
    }

    header::after {
      content: "ØªØµÙ…ÙŠÙ…: Ø£Ø­Ù…Ø¯ ØµÙ„Ø§Ø­";
      position: absolute;
      bottom: 5px;
      right: 10px;
      font-size: 0.7rem;
      opacity: 0.7;
    }

    .container {
      display: grid;
      grid-template-columns: 250px 1fr;
      min-height: calc(100vh - 60px);
    }

    nav {
      background-color: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: fixed;
      width: 250px;
      height: 100%;
      overflow-y: auto;
      padding: 1rem 0;
    }

    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    nav ul li {
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      color: #333;
      transition: all 0.3s ease;
    }

    nav ul li:hover {
      background-color: #00796b;
      color: white;
    }

    nav ul li span {
      margin-right: 10px;
    }

    .main {
      padding: 2rem;
      margin-right: 250px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
    }

    .card {
      background-color: white;
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #00796b;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .card span {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .barcode-section {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: block;
    }

    .barcode-input {
      width: 100%;
      padding: 1rem;
      border: 2px solid #00796b;
      border-radius: 8px;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      text-align: center;
      direction: ltr;
    }

    .barcode-input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(0,121,107,0.2);
    }

    .scanner-container {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
      position: relative;
      overflow: hidden;
      border-radius: 8px;
    }

    #qr-reader {
      width: 100% !important;
      border: none !important;
    }

    .scan-button {
      background: #00796b;
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 8px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 1rem 0;
      width: 100%;
      display: block;
    }

    .scan-button:hover {
      background: #00695c;
      transform: translateY(-2px);
    }

    .guide-box {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 70%;
      height: 200px;
      border: 3px solid #00796b;
      border-radius: 8px;
      pointer-events: none;
      z-index: 1000;
    }

    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }

      nav {
        width: 100%;
        height: auto;
        position: relative;
      }

      .main {
        margin-right: 0;
        padding: 1rem;
      }

      .grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }

      .barcode-input {
        font-size: 1rem;
        padding: 0.8rem;
      }

      .scan-button {
        font-size: 1rem;
        padding: 0.8rem 1.5rem;
      }
    }
  </style>
</head>
<body>
  <header>
    Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø¯ - Ø´Ø±ÙƒØ© Ø§Ù„Ù‚Ø±Ø¹Ø§ÙˆÙŠ
  </header>
  <div class="container">
    <nav>
      <ul>
        <li><span>ğŸ </span>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</li>
        <li><span>ğŸ›’</span>Ø§Ù„Ø£ØµÙ†Ø§Ù</li>
        <li><span>ğŸ“„</span>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</li>
        <li><span>ğŸ’°</span>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</li>
        <li><span>ğŸ“Š</span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</li>
        <li><span>ğŸ§‘â€ğŸ’¼</span>Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</li>
        <li><span>ğŸ‘¥</span>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</li>
        <li><span>ğŸ¬</span>Ø§Ù„Ù…Ø®Ø§Ø²Ù†</li>
        <li><span>âš™ï¸</span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</li>
        <li><span>ğŸ“¦</span>Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</li>
        <li><span>ğŸ”</span>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</li>
      </ul>
    </nav>
    <main class="main">
      <div class="barcode-section">
        <h2>Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</h2>
        <input type="text" class="barcode-input" id="barcodeInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙŠØ¯ÙˆÙŠØ§Ù‹..." autocomplete="off">
        <button class="scan-button" id="scanButton">
          <span>ğŸ“·</span> Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
        </button>
        <div class="scanner-container" id="scannerContainer" style="display: none;">
          <div id="qr-reader"></div>
          <div class="guide-box"></div>
        </div>
      </div>
      <div class="grid">
        <div class="card"><span>ğŸ“„</span>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</div>
        <div class="card"><span>ğŸ›’</span>Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
        <div class="card"><span>ğŸ’°</span>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
        <div class="card"><span>ğŸ“Š</span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
        <div class="card"><span>ğŸ“¥</span>Ø§Ù„ÙˆØ§Ø±Ø¯</div>
        <div class="card"><span>ğŸ“¤</span>Ø§Ù„ØµØ§Ø¯Ø±</div>
        <div class="card"><span>ğŸ§‘â€ğŸ’¼</span>Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</div>
        <div class="card"><span>ğŸ‘¥</span>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
        <div class="card"><span>ğŸ¬</span>Ø§Ù„Ù…Ø®Ø§Ø²Ù†</div>
        <div class="card"><span>âš™ï¸</span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
      </div>
    </main>
  </div>

  <script type="module">
    import { BrowserMultiFormatReader } from 'https://cdn.jsdelivr.net/npm/@zxing/browser@0.2.7/esm/index.min.js';

    let codeReader = new BrowserMultiFormatReader();
    let selectedDeviceId;
    const scanButton = document.getElementById('scanButton');
    const scannerContainer = document.getElementById('scannerContainer');
    const barcodeInput = document.getElementById('barcodeInput');

    // Focus barcode input on page load
    window.addEventListener('DOMContentLoaded', () => {
      barcodeInput.focus();
    });

    // Clean barcode input
    barcodeInput.addEventListener('input', (e) => {
      e.target.value = e.target.value.replace(/[^\w\d]/g, '');
    });

    // Handle Enter key
    barcodeInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && e.target.value.length >= 5) {
        handleBarcode(e.target.value);
      } else if (e.key === 'Enter') {
        Swal.fire({
          icon: 'warning',
          title: 'ØªÙ†Ø¨ÙŠÙ‡',
          text: 'ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ 5 Ø£Ø±Ù‚Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„',
          confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
        });
      }
    });

    async function startScanner() {
      try {
        const devices = await BrowserMultiFormatReader.listVideoInputDevices();
        selectedDeviceId = devices.find(d => d.label.toLowerCase().includes('back'))?.deviceId || devices[0]?.deviceId;

        if (!selectedDeviceId) {
          throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒØ§Ù…ÙŠØ±Ø§');
        }

        scannerContainer.style.display = 'block';
        scanButton.textContent = 'ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø³Ø­';

        await codeReader.decodeFromVideoDevice(selectedDeviceId, 'qr-reader', (result, err) => {
          if (result) {
            handleBarcode(result.getText());
          }
        });
      } catch (err) {
        Swal.fire({
          icon: 'error',
          title: 'Ø®Ø·Ø£',
          text: 'ÙØ´Ù„ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: ' + err.message,
          confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
        });
        stopScanner();
      }
    }

    function stopScanner() {
      codeReader.reset();
      scannerContainer.style.display = 'none';
      scanButton.textContent = 'ğŸ“· Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯';
    }

    scanButton.addEventListener('click', () => {
      if (scannerContainer.style.display === 'none') {
        startScanner();
      } else {
        stopScanner();
      }
    });

    function handleBarcode(barcode) {
      Swal.fire({
        icon: 'success',
        title: 'ØªÙ… Ø§Ù„Ù…Ø³Ø­ Ø¨Ù†Ø¬Ø§Ø­',
        text: 'Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ' + barcode,
        confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
      });
      barcodeInput.value = barcode;
      stopScanner();
      barcodeInput.focus();
    }

    // Clean up on page unload
    window.addEventListener('beforeunload', () => {
      stopScanner();
    });
  </script>
</body>
</html>
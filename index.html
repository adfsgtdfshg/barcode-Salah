<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø¯ - Ø´Ø±ÙƒØ© Ø§Ù„Ù‚Ø±Ø¹Ø§ÙˆÙŠ</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Cairo', sans-serif;
    }

    body {
      margin: 0;
      background-color: #f4f4f4;
    }

    header {
      background-color: #00796b;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      position: relative;
    }

    header::after {
      content: "ØªØµÙ…ÙŠÙ…: Ø£Ø­Ù…Ø¯ ØµÙ„Ø§Ø­";
      position: absolute;
      bottom: 5px;
      right: 10px;
      font-size: 0.7rem;
      opacity: 0.7;
    }

    .container {
      display: grid;
      grid-template-columns: 250px 1fr;
      min-height: calc(100vh - 60px);
    }

    nav {
      background-color: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: fixed;
      width: 250px;
      height: 100%;
      overflow-y: auto;
      padding: 1rem 0;
    }

    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    nav ul li {
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      color: #333;
      transition: all 0.3s ease;
    }

    nav ul li:hover {
      background-color: #00796b;
      color: white;
    }

    nav ul li span {
      margin-right: 10px;
    }

    .main {
      padding: 2rem;
      margin-right: 250px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
    }

    .card {
      background-color: white;
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #00796b;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .card span {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }

      nav {
        width: 100%;
        height: auto;
        position: relative;
      }

      .main {
        margin-right: 0;
      }

      .grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }
    }
  </style>
</head>
<body>
  <header>
    Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±Ø¯ - Ø´Ø±ÙƒØ© Ø§Ù„Ù‚Ø±Ø¹Ø§ÙˆÙŠ
  </header>
  <div class="container">
    <nav>
      <ul>
        <li><span>ğŸ </span>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</li>
        <li><span>ğŸ›’</span>Ø§Ù„Ø£ØµÙ†Ø§Ù</li>
        <li><span>ğŸ“„</span>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</li>
        <li><span>ğŸ’°</span>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</li>
        <li><span>ğŸ“Š</span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</li>
        <li><span>ğŸ§‘â€ğŸ’¼</span>Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</li>
        <li><span>ğŸ‘¥</span>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</li>
        <li><span>ğŸ¬</span>Ø§Ù„Ù…Ø®Ø§Ø²Ù†</li>
        <li><span>âš™ï¸</span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</li>
        <li><span>ğŸ“¦</span>Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</li>
        <li><span>ğŸ”</span>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</li>
      </ul>
    </nav>
    <main class="main">
      <div class="grid">
        <div class="card"><span>ğŸ“„</span>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</div>
        <div class="card"><span>ğŸ›’</span>Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
        <div class="card"><span>ğŸ’°</span>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
        <div class="card"><span>ğŸ“Š</span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
        <div class="card"><span>ğŸ“¥</span>Ø§Ù„ÙˆØ§Ø±Ø¯</div>
        <div class="card"><span>ğŸ“¤</span>Ø§Ù„ØµØ§Ø¯Ø±</div>
        <div class="card"><span>ğŸ§‘â€ğŸ’¼</span>Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</div>
        <div class="card"><span>ğŸ‘¥</span>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
        <div class="card"><span>ğŸ¬</span>Ø§Ù„Ù…Ø®Ø§Ø²Ù†</div>
        <div class="card"><span>âš™ï¸</span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
      </div>
    </main>
  </div>
</body>
</html>


// Autofocus barcode input on page load and after each scan
function focusBarcodeInput() {
    const input = document.getElementById('manualBarcode');
    if (input) {
        input.focus();
        input.select();
    }
}
window.addEventListener('DOMContentLoaded', focusBarcodeInput);

// Clean and validate barcode input
function cleanBarcodeInput(value) {
    // Remove spaces and unwanted characters (keep digits and letters only)
    return value.replace(/[^\w\d]/g, '').trim();
}

// Enhanced search button click
const barcodeInput = document.getElementById('manualBarcode');
document.getElementById('searchBtn').addEventListener('click', function() {
    let barcode = barcodeInput.value;
    barcode = cleanBarcodeInput(barcode);
    barcodeInput.value = barcode;
    if (barcode.length < 5) {
        Swal.fire({
            icon: 'warning',
            title: 'ØªÙ†Ø¨ÙŠÙ‡',
            text: 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¨Ø§Ø±ÙƒÙˆØ¯ ØµØ§Ù„Ø­ (5 Ø®Ø§Ù†Ø§Øª Ø£Ùˆ Ø£ÙƒØ«Ø±)'
        });
        focusBarcodeInput();
        return;
    }
    searchProduct(barcode);
    focusBarcodeInput();
});

// Search on Enter key
barcodeInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        document.getElementById('searchBtn').click();
    }
});

// Instant validation on input
barcodeInput.addEventListener('input', function() {
    let cleaned = cleanBarcodeInput(barcodeInput.value);
    if (barcodeInput.value !== cleaned) {
        barcodeInput.value = cleaned;
    }
});

// After successful scan, focus input
function onScanSuccess(decodedText) {
    scanner.pause();
    searchProduct(decodedText);
    setTimeout(() => {
        scanner.resume();
        focusBarcodeInput();
    }, 3000);
}
<!-- ZXing library CDN -->
<script type="module">
  import { BrowserMultiFormatReader } from 'https://cdn.jsdelivr.net/npm/@zxing/browser@0.2.7/esm/index.min.js';
  let codeReader;
  let selectedDeviceId;
  let scanning = false;
  let torchOn = false;
  const scannerContainer = document.getElementById('scanner-container');
  const qrReader = document.getElementById('qr-reader');
  const scanBtn = document.getElementById('startScannerBtn');
  const torchBtn = document.createElement('button');
  torchBtn.innerHTML = '<i class="fa fa-bolt"></i>';
  torchBtn.className = 'btn btn-warning';
  torchBtn.style.margin = '10px';
  torchBtn.style.display = 'none';
  scannerContainer.appendChild(torchBtn);
  function showGuideBox() {
    let guide = document.getElementById('guide-box');
    if (!guide) {
      guide = document.createElement('div');
      guide.id = 'guide-box';
      guide.style.position = 'absolute';
      guide.style.border = '3px dashed #00c853';
      guide.style.width = '70%';
      guide.style.height = '60%';
      guide.style.top = '20%';
      guide.style.left = '15%';
      guide.style.pointerEvents = 'none';
      scannerContainer.appendChild(guide);
    }
  }
  function hideGuideBox() {
    const guide = document.getElementById('guide-box');
    if (guide) guide.remove();
  }
  async function startZXingScanner() {
    if (scanning) return;
    scanning = true;
    qrReader.innerHTML = '';
    showGuideBox();
    codeReader = new BrowserMultiFormatReader();
    const devices = await BrowserMultiFormatReader.listVideoInputDevices();
    // Prefer back camera
    selectedDeviceId = devices.find(d => d.label.toLowerCase().includes('back'))?.deviceId || devices[0]?.deviceId;
    if (!selectedDeviceId) {
      Swal.fire('No camera found', '', 'error');
      scanning = false;
      return;
    }
    try {
      await codeReader.decodeFromVideoDevice(selectedDeviceId, qrReader, (result, err, controls) => {
        if (result) {
          scanning = false;
          hideGuideBox();
          controls.stop();
          Swal.fire({title:'Barcode found!',text:result.getText(),icon:'success',timer:2000,showConfirmButton:false});
          document.getElementById('manualBarcode').value = result.getText();
          document.getElementById('manualBarcode').dispatchEvent(new Event('input'));
          setTimeout(()=>{startZXingScanner();}, 2500);
        } else if (err && !(err instanceof ZXing.NotFoundException)) {
          Swal.fire('Scan error', err.message, 'error');
        }
      }, {
        video: { facingMode: { exact: 'environment' } },
        torch: torchOn
      });
      // Torch control
      torchBtn.style.display = 'inline-block';
      torchBtn.onclick = async () => {
        torchOn = !torchOn;
        await codeReader.reset();
        scanning = false;
        startZXingScanner();
      };
    } catch (e) {
      Swal.fire('Camera error', e.message, 'error');
      scanning = false;
      hideGuideBox();
    }
  }
  scanBtn.onclick = startZXingScanner;
</script>